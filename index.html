<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Match Pro - Family Edition</title>
    <meta name="description" content="A customizable memory game. Play with classic fruits or upload your own family photos!">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://trtx01.github.io/memory-game/">
    <meta property="og:title" content="Memory Match Pro">
    <meta property="og:description" content="Match pairs of fruits or your own family photos!">
    <meta property="og:image" content="https://raw.githubusercontent.com/TrTx01/memory-game/main/preview.png">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Memory Match Pro">
    <meta property="twitter:image" content="https://raw.githubusercontent.com/TrTx01/memory-game/main/preview.png">

    <style>
        :root {
            --primary: #3498db;
            --success: #27ae60;
            --bg: #f0f2f5;
            --glass: rgba(255, 255, 255, 0.95);
            --card-back: #2c3e50;
        }

        body, html {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Intro Screen */
        #intro-screen {
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
        }

        .hero-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 40px; border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            max-width: 500px; text-align: center; margin: 20px;
        }

        .hero-image {
            width: 100%; border-radius: 15px;
            margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .mode-container {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 15px; margin: 20px 0;
        }

        .mode-box {
            padding: 10px; border: 1px solid #ddd; border-radius: 10px; background: white;
        }

        .start-btn {
            background: var(--primary); color: white; border: none;
            padding: 15px 40px; font-size: 1.2rem; border-radius: 50px;
            cursor: pointer; font-weight: bold; transition: 0.2s;
        }

        .start-btn:hover { transform: scale(1.05); background: #2980b9; }

        /* Game Screen */
        #game-screen { display: none; flex-direction: column; align-items: center; padding: 20px; position: relative; }

        /* Overlays (Instructions & Countdown) */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 100; color: white;
            text-align: center; padding: 20px; box-sizing: border-box;
        }

        .instruction-box {
            background: white; color: #333; padding: 30px; border-radius: 20px; max-width: 400px;
        }

        #countdown-text { font-size: 8rem; font-weight: bold; text-shadow: 0 0 20px rgba(255,255,255,0.5); }

        /* Game UI */
        .status-msg { margin: 10px 0; font-style: italic; color: #555; height: 1.2rem; }
        
        .controls {
            background: white; padding: 20px; border-radius: 15px;
            margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center; width: 100%; max-width: 400px;
        }

        .grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 10px; max-width: 400px; width: 100%;
        }

        /* Card Styles */
        .card {
            aspect-ratio: 1 / 1; background-color: var(--card-back);
            border-radius: 8px; cursor: pointer; position: relative;
            transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card.flipped { transform: rotateY(180deg); }

        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; display: flex;
            align-items: center; justify-content: center; border-radius: 8px;
        }

        .card-front { background: white; transform: rotateY(180deg); font-size: 2rem; }
        .card-front img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
        .card-back { color: white; font-size: 1.5rem; font-weight: bold; }

        .card.matched .card-front { background: var(--success); color: white; }
        .hidden { display: none !important; }

        button.btn-small { padding: 8px 15px; cursor: pointer; border-radius: 5px; border: 1px solid #ddd; background: #fff; }
    </style>
</head>
<body>

    <div id="instruction-overlay" class="overlay hidden">
        <div class="instruction-box">
            <h2>How to Play</h2>
            <ul style="text-align: left; line-height: 1.6;">
                <li>Tap cards to find <strong>matching pairs</strong>.</li>
                <li>Match all 8 pairs to win.</li>
                <li>Try to get the lowest move count!</li>
            </ul>
            <p><em>Cards will be revealed for 3 seconds first.</em></p>
            <button class="start-btn" onclick="startCountdown()">Ready, Go!</button>
        </div>
    </div>

    <div id="countdown-overlay" class="overlay hidden">
        <div id="countdown-text">3</div>
        <p>MEMORIZE THE POSITIONS!</p>
    </div>

    <section id="intro-screen">
        <div class="hero-card">
            <img src="preview.png" alt="Cover" class="hero-image">
            <h1>Memory Match Pro</h1>
            <div class="mode-container">
                <div class="mode-box"><h3>üçé Classic</h3><p>Fruit Emojis</p></div>
                <div class="mode-box"><h3>üì∏ Family</h3><p>Your Photos</p></div>
            </div>
            <button class="start-btn" onclick="initGame()">Enter Game</button>
        </div>
    </section>

    <section id="game-screen">
        <div class="controls">
            <div style="margin-bottom: 10px;">
                <label><input type="checkbox" id="modeSwitch" onchange="handleModeChange()"> Family Mode</label>
            </div>
            <div id="uploadSection" class="hidden">
                <input type="file" id="imageUpload" accept="image/*" multiple onchange="processImages(event)">
                <p style="font-size: 0.75rem;">Upload 8 photos (Saved locally)</p>
            </div>
            <div id="status-text" class="status-msg">Good luck!</div>
            <div style="font-weight: bold;">Moves: <span id="moves">0</span> | Best: <span id="best">--</span></div>
            <div style="margin-top: 15px;">
                <button class="btn-small" onclick="resetGame()">Reset Board</button>
                <button class="btn-small" onclick="location.reload()">Home Page</button>
            </div>
        </div>
        <div class="grid" id="gameGrid"></div>
    </section>

    <script>
        const icons = ['üçé', 'üçå', 'üçá', 'üçì', 'üçí', 'üçç', 'ü•ù', 'üçâ'];
        let familyImages = JSON.parse(localStorage.getItem('familyPics')) || [];
        let flippedCards = [];
        let matchedCount = 0;
        let moves = 0;
        let isLocked = true; // Board locked until countdown ends

        function initGame() {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            document.getElementById('instruction-overlay').classList.remove('hidden');
            updateBestScore();
            createBoard(); // Create board in background
        }

        function startCountdown() {
            document.getElementById('instruction-overlay').classList.add('hidden');
            document.getElementById('countdown-overlay').classList.remove('hidden');
            
            // Reveal all cards
            document.querySelectorAll('.card').forEach(c => c.classList.add('flipped'));
            
            let count = 3;
            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    document.getElementById('countdown-text').textContent = count;
                } else {
                    clearInterval(timer);
                    document.getElementById('countdown-overlay').classList.add('hidden');
                    // Flip back and unlock
                    document.querySelectorAll('.card').forEach(c => c.classList.remove('flipped'));
                    isLocked = false;
                    updateStatus("Find your first pair!");
                }
            }, 1000);
        }

        function handleModeChange() {
            const isFamily = document.getElementById('modeSwitch').checked;
            document.getElementById('uploadSection').classList.toggle('hidden', !isFamily);
            if(isFamily && familyImages.length < 8) {
                updateStatus("Please upload photos to use Family Mode");
            }
            resetGame();
        }

        async function processImages(event) {
            const files = Array.from(event.target.files);
            if (files.length !== 8) return alert("Please select exactly 8 photos.");
            familyImages = [];
            const promises = files.map(file => {
                return new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = (e) => { familyImages.push(e.target.result); resolve(); };
                    reader.readAsDataURL(file);
                });
            });
            await Promise.all(promises);
            localStorage.setItem('familyPics', JSON.stringify(familyImages));
            resetGame();
        }

        function createBoard() {
            const grid = document.getElementById('gameGrid');
            grid.innerHTML = '';
            const isFamily = document.getElementById('modeSwitch').checked && familyImages.length === 8;
            const source = isFamily ? familyImages : icons;
            const gameCards = [...source, ...source].sort(() => Math.random() - 0.5);

            gameCards.forEach(content => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.val = content;
                card.innerHTML = `<div class="card-back">?</div><div class="card-front">${isFamily ? `<img src="${content}">` : content}</div>`;
                card.addEventListener('click', flipCard);
                grid.appendChild(card);
            });
        }

        function flipCard() {
            if (isLocked || this.classList.contains('flipped') || this.classList.contains('matched')) return;
            this.classList.add('flipped');
            flippedCards.push(this);
            if (flippedCards.length === 1) {
                updateStatus("Find the match...");
            } else if (flippedCards.length === 2) {
                moves++;
                document.getElementById('moves').textContent = moves;
                checkMatch();
            }
        }

        function checkMatch() {
            isLocked = true;
            const [c1, c2] = flippedCards;
            if (c1.dataset.val === c2.dataset.val) {
                c1.classList.add('matched'); c2.classList.add('matched');
                matchedCount += 2; flippedCards = []; isLocked = false;
                updateStatus("Great job! Found a pair.");
                if (matchedCount === 16) handleWin();
            } else {
                updateStatus("Not a match. Try again!");
                setTimeout(() => {
                    c1.classList.remove('flipped'); c2.classList.remove('flipped');
                    flippedCards = []; isLocked = false;
                }, 1000);
            }
        }

        function handleWin() {
            updateStatus("üèÜ You've cleared the board!");
            const best = localStorage.getItem('bestScore') || Infinity;
            if (moves < best) {
                localStorage.setItem('bestScore', moves);
                alert(`New Record! ${moves} moves.`);
            } else {
                alert(`Win! Moves: ${moves}`);
            }
            updateBestScore();
        }

        function updateStatus(txt) {
            document.getElementById('status-text').textContent = txt;
        }

        function updateBestScore() {
            const best = localStorage.getItem('bestScore');
            document.getElementById('best').textContent = best ? best : "--";
        }

        function resetGame() {
            moves = 0; matchedCount = 0; flippedCards = []; 
            document.getElementById('moves').textContent = "0";
            createBoard();
            // Ask for instruction again on reset for clarity
            document.getElementById('instruction-overlay').classList.remove('hidden');
            isLocked = true;
            document.getElementById('countdown-text').textContent = "3";
        }
    </script>
</body>
</html>
